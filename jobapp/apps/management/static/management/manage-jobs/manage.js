console.log("loaded managejobs.js!");

$(document).ready(function() {
    const jobsTable = $('#jobsTable').DataTable({
        dom: 'Bfrtip',
        // "columnDefs": [
        //     { "width": "30%", "targets": 0 },
        //     { "width": "30%", "targets": 1 },
        //     { "width": "20%", "targets": 2 },
        //     { "width": "15%", "targets": 3 },
        //     { "width": "10%", "targets": 4 },
        //     { "width": "5%", "targets": 5 },
          
        //   ],
        buttons: [
          {
              extend: 'pdf',
              exportOptions: {
                columns: [ 0, 1,2,3,4 ]
              },
          
              title: 'Job Listing Report',
              customize: function (doc) {
                // change table header background color
                doc.content[1].table.headerRows = 1;
                doc.content[1].table.widths = Array(doc.content[1].table.body[0].length).fill('auto');
                doc.content[1].table.body[0].forEach(function (column, index) {
                    column.fillColor = '#386641';
                });
            
                //set specific widths for the columns
                doc.content[1].table.widths = ['*', '*', '15%', '15%', '10%'];
            
            
                // align table header to left
                const header = doc.content[1].table.body[0];
                header.forEach(cell => {
                    cell.alignment = 'left';
                });

                // add margin to each cell
                const tableBody = doc.content[1].table.body;
                tableBody.forEach(row => {
                    row.forEach(cell => {
                        cell.margin = [5, 5, 5, 5]; 
                    });
                });
              
                // footer
                doc.footer = function (page, pages) {
                    return {
                        text: [
                            { text: `Generated by: ${generatedBy}\n`, alignment: 'left' },
                            {
                                text: 'Date Generated: ' + new Date().toLocaleString('en-US', {
                                    month: 'long',
                                    day: '2-digit',
                                    year: 'numeric',
                                    hour: 'numeric',
                                    minute: 'numeric',
                                    hour12: true
                                }), alignment: 'left'
                            }
                        ],
                        margin: [40, 0],
                        fontSize: 10
                    };
                };
            }
            
          },
      ]
    });

    $('#jobsSearchField').keyup(function(){
        jobsTable.search($(this).val()).draw();
    });
    
});
function jobsReport() {

  $('#jobsTable').DataTable().button('.buttons-html5').trigger();
}


function onDeleteJobHandler(jobId, jobTitle) {
    
    Swal.fire({
        title: "Delete?",
        text: `Are you sure you want to delete ${jobTitle}?`,
        icon: "warning",
        confirmButtonText: "Delete",
        confirmButtonColor: "#EF5350",
        showCancelButton: true,
        showCloseButton: false,
      }).then((result) => {
        if (result.isConfirmed) {
            window.location.href = `/management/jobs/delete/${jobId}/`;
        }
      });
}

function onActionJobHandler(action, jobTitle) {
    action = action.trim();
    jobTitle = jobTitle.trim();  
    Swal.fire({
        title: `${action}?`,
        text: `Are you sure you want to ${action} ${jobTitle}?`,
        icon: "warning",
        confirmButtonText: `${action}`,
        confirmButtonColor: "#EF5350",
        showCancelButton: true,
        showCloseButton: false,
      }).then((result) => {
        if(result.isConfirmed) {
         
          document.getElementById("job_action_form").submit();
        } 
      });
}

function onEditJobHandler(jobId) {
    window.location.href = `/management/jobs/edit/${jobId}/`;
}
