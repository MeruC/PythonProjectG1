console.log("loaded managecompanies.js!");

$(document).ready(function() {
    const companiesTable = $('#companiesTable').DataTable({
        dom: 'Bfrtip',
        "autoWidth": false,
        "columnDefs": [
          { "width": "5%", "targets": 0 },
          { "width": "25%", "targets": 1 },
          { "width": "25%", "targets": 2 },
          { "width": "15%", "targets": 3 },
          { "width": "15%", "targets": 4 },
          { "width": "10%", "targets": 5 },
          { "width": "5%", "targets": 6 }
        ],
        buttons: [
          {
              extend: 'pdf',
              download: 'open',
              exportOptions: {
                // starting index is 0
                columns: [  1,2,3,4,5 ],
              },
             
              title: 'List of Company',
              customize: function (doc) {
                // change table header background color
                doc.content[1].table.headerRows = 1;
                doc.content[1].table.widths = Array(doc.content[1].table.body[0].length).fill('auto');
                doc.content[1].table.body[0].forEach(function (column, index) {
                    column.fillColor = '#386641';
                });
            
                //set specific widths for the columns
                doc.content[1].table.widths = ['*', '*', '15%', '15%', '10%'];
            
            
                // align table header to left
                const header = doc.content[1].table.body[0];
                header.forEach(cell => {
                    cell.alignment = 'left';
                });


                const rowCount = doc.content[1].table.body.length - 1; 
              doc.content.push({ text: `Total: ${rowCount}`, alignment: 'left', margin: [5, 10] });

                // add margin to each cell
                const tableBody = doc.content[1].table.body;
                
                tableBody.forEach(row => {
                    row.forEach(cell => {
                        cell.margin = [5, 5, 5, 5]; 
                    });
                });
              
                // footer
                doc.footer = function (page, pages) {
                    return {
                        text: [
                            { text: `Generated by: ${generatedBy}\n`, alignment: 'left' },
                            {
                              text: 'Date Generated: ' + new Date().toLocaleString('en-US', {
                                    month: 'long',
                                    day: '2-digit',
                                    year: 'numeric',
                                    hour: 'numeric',
                                    minute: 'numeric',
                                    hour12: true
                                }), alignment: 'left'
                              },
                              { text: `\n${page}`, alignment: 'right' },
                        ],
                        margin: [40, 0],
                        fontSize: 10
                    };
                };
            }
            
          },
          // {
          //     extend: 'print',
          //     exportOptions: {
          //       columns: [ 1,2,3,4 ,5 ]
          //     }
          // }
      ]
    });

    $('#companiesSearchField').keyup(function(){
        companiesTable.search($(this).val()).draw();
    });

    
});
function companiesReport() {

  $('#companiesTable').DataTable().button('.buttons-html5').trigger();
}

function onDeleteCompanyHandler(companyId, companyName) {
    
    Swal.fire({
        title: "Delete?",
        text: `Are you sure you want to delete ${companyName}?`,
        icon: "warning",
        confirmButtonText: "Delete",
        confirmButtonColor: "#EF5350",
        showCancelButton: true,
        showCloseButton: false,
      }).then((result) => {
        if (result.isConfirmed) {
            window.location.href = `/management/companies/delete/${companyId}/`;
        }
      });
}

  function onActionCompanyHandler(action, companyName) {
    action = action.trim();
    companyName = companyName.trim();   
    Swal.fire({
        title: `${action}?`,
        text: `Are you sure you want to ${action.toLowerCase()} ${companyName}?`,
        icon: "warning",
        confirmButtonText: `${action}`,
        
        confirmButtonColor: action === "Activate" ? "#386641" : "#BC4749",
        showCancelButton: true,
        showCloseButton: false,
      }).then((result) => {
        if(result.isConfirmed) {
         
          document.getElementById("company_action_form").submit();
        } 
      });
}

function onEditCompanyHandler(companyId) {
    window.location.href = `/management/companies/edit/${companyId}/`;
}


